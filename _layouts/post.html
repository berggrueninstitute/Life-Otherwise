---
layout: default
---

{%- include menu.html -%}

<div> <!-- sticky container -->
    <div id="article-outline"></div>
    <div id="top-mask"></div>
    <div id="left-mask"></div>
    <div id="right-mask"></div>
    <div id="btm-mask"></div>
    <div id="article-container">
        <div id="moving-header">
            <h1 class="article-title">{{ page.full-title }}</h1>
            <h2 class="article-author">
                {% assign author_count = page.authors | size %}
                {% for author in page.authors %}
                    <span data-author="{{ author.name }}" data-bio="{{ author.bio | markdownify | escape }}" onclick="openPopup(this)">{{ author.name }}</span>
                    {% if forloop.index < author_count %}
                        &amp;
                    {% endif %}
                {% endfor %}
            </h2>
        </div>
        {{ content }}
        <div id="dropdown-container">
            {% if page.exegesis %}
            <div id="exegesis">
                {{ page.exegesis | markdownify }}
            </div>
            {% endif %}
            {% if page.endnotes %}
            <div id="footnotes">
                {{ page.endnotes | markdownify }}
            </div>
            {% endif %}
        </div>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span id="closePopup" class="close">&times;</span>
            <p id="popup-author"></p>
            <p id="popup-bio"></p>
        </div>
    </div>
</div>

{%- include footer.html -%}

<script src='{{ "/scripts/populate-menu.js" | relative_url }}'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('dropdown-container');
        
        // Add the content containers
        const exegesisContent = document.getElementById('exegesis');
        const footnotesContent = document.getElementById('footnotes');

        // Add the buttons
        if (exegesisContent) {
            const exegesisWrapper = createWrapper('Exegesis', 'exegesis', exegesisContent);
            container.appendChild(exegesisWrapper);
        }

        if (footnotesContent) {
            const footnotesWrapper = createWrapper('Endnotes', 'footnotes', footnotesContent);
            container.appendChild(footnotesWrapper);
        }
    });

    function createWrapper(buttonText, targetId, contentElement) {
        const wrapper = document.createElement('div');
        wrapper.classList = "dropdown-subcontainer"
        const button = createButton(buttonText, targetId);

        wrapper.appendChild(button);
        wrapper.appendChild(contentElement);
        contentElement.className = 'dropdown-content';
        
        return wrapper;
    }

    function createButton(text, targetId) {
        const button = document.createElement('button');
        button.className = 'dropbtn';
        button.textContent = text;
        
        const caret = document.createElement('span');
        caret.className = 'caret';
        caret.textContent = 'v'; // Unicode character for caret
        button.appendChild(caret);
        
        button.onclick = () => toggleDropdown(targetId, button);
        return button;
    }

    function toggleDropdown(id, button) {
        const content = document.getElementById(id);
        const isOpen = content.style.display === 'block';
        content.style.display = isOpen ? 'none' : 'block';
        button.classList.toggle('open', !isOpen);
        footerScoot();
    }

    function openPopup(element) {
        const author = element.getAttribute('data-author');
        const bio = element.getAttribute('data-bio');

        document.getElementById('popup-author').innerText = author;
        document.getElementById('popup-bio').innerHTML = bio;

        document.getElementById('popup').style.display = 'flex';
    }

    document.getElementById('closePopup').addEventListener('click', function() {
        document.getElementById('popup').style.display = 'none';
    });

    window.addEventListener('click', function(event) {
        if (event.target == document.getElementById('popup')) {
            document.getElementById('popup').style.display = 'none';
        }
    });

    //js for header motion
    let movingHeaderCopy
    updateHeader()

    window.addEventListener('scroll', function() {
        let scrollPosition = window.scrollY;
        let header = document.getElementById('moving-header');

        if (scrollPosition <= 500) {
            let translateX = (scrollPosition / 500) * 100;
            console.log(movingHeaderCopy)
            movingHeaderCopy.style.transform = `translateX(${-translateX}vw)`;
        } else {
            movingHeaderCopy.style.transform = `translateX(-100vw)`; // Move off screen after 300px
        }
    });

    //for right-mask
    document.getElementById('right-mask').style.width = `${window.innerWidth - document.getElementById('article-outline').getBoundingClientRect().right}px`;

    window.addEventListener("resize", function(){
        document.getElementById('right-mask').style.width = `${window.innerWidth - document.getElementById('article-outline').getBoundingClientRect().right}px`;
        updateHeader();

    });

    //for moving header
    // grab the moving header, make a copy with the same attributes but position fixed (positioned exactly where the original is), and hide the original

    function updateHeader() {
        let movingHeader = document.getElementById('moving-header');
        movingHeader.style.visibility = 'hidden';

        let oldMovingHeaderCopy = document.getElementById('moving-header-copy');
        if (oldMovingHeaderCopy) {
            document.body.removeChild(oldMovingHeaderCopy);
        }
        movingHeaderCopy = movingHeader.cloneNode(true);
        document.body.appendChild(movingHeaderCopy);
        movingHeaderCopy.id = 'moving-header-copy';
        movingHeaderCopy.style.visibility = 'visible';
        movingHeaderCopy.style.position = 'fixed';

        // movingHeaderCopy.style.top = movingHeader.getBoundingClientRect().top + 'px';
        movingHeaderCopy.style.top = '0px';
        movingHeaderCopy.style.left = movingHeader.getBoundingClientRect().left + 'px';
        movingHeaderCopy.style.width = movingHeader.getBoundingClientRect().width + 'px';
    }

</script>